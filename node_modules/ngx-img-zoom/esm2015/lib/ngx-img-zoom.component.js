/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Renderer2, ElementRef, ViewChild, Input } from '@angular/core';
import { NgxImgZoomService } from './ngx-img-zoom.service';
export class NgxImgZoomComponent {
    /**
     * @param {?} renderer
     * @param {?} ngxZoomService
     */
    constructor(renderer, ngxZoomService) {
        this.renderer = renderer;
        this.ngxZoomService = ngxZoomService;
        this.hide = true;
        this._triggerAnimationIn = false;
        this.notFirstTime = false;
        this.zoomMode = this.ngxZoomService.zoomMode;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set _imgSrc(val) {
        this.zoomImage = val;
        if (this.notFirstTime === true) {
            this.renderer.setStyle(this.result, 'backgroundImage', "url('" + val + "')");
        }
        this.notFirstTime = true;
        // this.renderer.setStyle(this.result, 'backgroundImage', val);
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set _zoomImage(val) {
        this.previewImage = val;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.img = this.imgElmRef.nativeElement;
        this.result = this.resultElmRef.nativeElement;
        this.container = this.containerElmRef.nativeElement;
        this.renderer.setAttribute(this.img, 'style', (/** @type {?} */ (this.imgStyle)));
        this.renderer.setAttribute(this.result, 'style', (/** @type {?} */ (this.resultStyle)));
        this.renderer.setAttribute(this.container, 'style', (/** @type {?} */ (this.containerStyle)));
        this.imageZoom();
        this.renderer.setStyle(this.lens, 'visibility', 'hidden');
    }
    /**
     * @return {?}
     */
    imageZoom() {
        /*create lens:*/
        this.lens = this.renderer.createElement('DIV');
        this.renderer.addClass(this.lens, 'img-zoom-lens');
        this.renderer.setAttribute(this.lens, 'style', (/** @type {?} */ (this.lensStyle)));
        /*insert lens:*/
        this.renderer.insertBefore(this.img.parentElement, this.lens, this.img);
        /*calculate the ratio between result DIV and lens:*/
        this.cx = this.result.offsetWidth / this.lens.offsetWidth;
        this.cy = this.result.offsetHeight / this.lens.offsetHeight;
        /*set background properties for the result DIV:*/
        this.renderer.setStyle(this.result, 'backgroundImage', "url('" + this.zoomImage + "')");
        this.renderer.setStyle(this.result, 'backgroundSize', (this.img.width * this.cx) + 'px ' + (this.img.height * this.cy) + 'px');
        // this.renderer.setStyle(this.img.parentElement, 'position', 'relative')
        /*execute a function when someone moves the cursor over the image, or the lens:*/
        this.renderer.listen(this.lens, 'mousemove', this.moveLens.bind(this));
        this.renderer.listen(this.img, 'mousemove', this.moveLens.bind(this));
        /*and also for touch screens:*/
        this.renderer.listen(this.img, 'touchmove', this.moveLens.bind(this));
        this.renderer.listen(this.lens, 'touchmove', this.moveLens.bind(this));
    }
    /**
     * @param {?} e
     * @return {?}
     */
    moveLens(e) {
        /** @type {?} */
        let pos;
        /** @type {?} */
        let x;
        /** @type {?} */
        let y;
        /*prevent any other actions that may occur when moving over the image:*/
        e.preventDefault();
        /*get the cursor's x and y positions:*/
        pos = this.getCursorPos(e);
        /*calculate the position of the lens:*/
        x = pos.x - (this.lens.offsetWidth / 2);
        y = pos.y - (this.lens.offsetHeight / 2);
        /*prevent the lens from being positioned outside the image:*/
        if (x > this.img.width - this.lens.offsetWidth) {
            x = this.img.width - this.lens.offsetWidth;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        else {
            this.hide = false;
            this.renderer.setStyle(this.lens, 'visibility', 'visible');
        }
        if (x < 0) {
            x = 0;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        if (y > this.img.height - this.lens.offsetHeight) {
            y = this.img.height - this.lens.offsetHeight;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        if (y < 0) {
            y = 0;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        /*set the position of the lens:*/
        this.renderer.setStyle(this.lens, 'left', x + 'px');
        this.renderer.setStyle(this.lens, 'top', y + 'px');
        /*display what the lens 'sees':*/
        this.renderer.setStyle(this.result, 'backgroundPosition', '-' + (x * this.cx) + 'px -' + (y * this.cy) + 'px');
    }
    /**
     * @param {?} e
     * @return {?}
     */
    getCursorPos(e) {
        /** @type {?} */
        let a;
        /** @type {?} */
        let x = 0;
        /** @type {?} */
        let y = 0;
        e = e || window.event;
        /*get the x and y positions of the image:*/
        a = this.img.getBoundingClientRect();
        /*calculate the cursor's x and y coordinates, relative to the image:*/
        x = e.pageX - a.left;
        y = e.pageY - a.top;
        /*consider any page scrolling:*/
        x = x - window.pageXOffset;
        y = y - window.pageYOffset;
        return { x: x, y: y };
    }
    /**
     * @return {?}
     */
    handleMouseLeave() {
        this.hide = true;
        this.renderer.setStyle(this.lens, 'visibility', 'hidden');
    }
}
NgxImgZoomComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-img-zoom',
                template: "<div  class=\"img-zoom-container\" #container>\n    <img id=\"myimage\" [src]=\"previewImage\" #img (mouseleave)=\"handleMouseLeave()\">\n    <div  [ngClass]=\"{'hide': hide}\" \n        id=\"myresult\" \n        class=\"img-zoom-result\" \n        #result>\n    </div>\n</div>  ",
                styles: ["*{box-sizing:border-box}.img-zoom-container{position:absolute}.img-zoom-lens{position:absolute;border:1px solid #d4d4d4;width:40px;height:40px}.img-zoom-result{border:1px solid #d4d4d4;width:300px;height:300px}.hide{visibility:hidden}"]
            }] }
];
/** @nocollapse */
NgxImgZoomComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: NgxImgZoomService }
];
NgxImgZoomComponent.propDecorators = {
    imgElmRef: [{ type: ViewChild, args: ['img',] }],
    resultElmRef: [{ type: ViewChild, args: ['result',] }],
    containerElmRef: [{ type: ViewChild, args: ['container',] }],
    imgStyle: [{ type: Input }],
    resultStyle: [{ type: Input }],
    lensStyle: [{ type: Input }],
    containerStyle: [{ type: Input }],
    _imgSrc: [{ type: Input, args: ['zoomImageSrc',] }],
    _zoomImage: [{ type: Input, args: ['previewImageSrc',] }]
};
if (false) {
    /** @type {?} */
    NgxImgZoomComponent.prototype.img;
    /** @type {?} */
    NgxImgZoomComponent.prototype.lens;
    /** @type {?} */
    NgxImgZoomComponent.prototype.result;
    /** @type {?} */
    NgxImgZoomComponent.prototype.cx;
    /** @type {?} */
    NgxImgZoomComponent.prototype.cy;
    /** @type {?} */
    NgxImgZoomComponent.prototype.container;
    /** @type {?} */
    NgxImgZoomComponent.prototype.hide;
    /** @type {?} */
    NgxImgZoomComponent.prototype._triggerAnimationIn;
    /** @type {?} */
    NgxImgZoomComponent.prototype.notFirstTime;
    /** @type {?} */
    NgxImgZoomComponent.prototype.zoomMode;
    /** @type {?} */
    NgxImgZoomComponent.prototype.imgElmRef;
    /** @type {?} */
    NgxImgZoomComponent.prototype.resultElmRef;
    /** @type {?} */
    NgxImgZoomComponent.prototype.containerElmRef;
    /** @type {?} */
    NgxImgZoomComponent.prototype.imgStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype.resultStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype.lensStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype.containerStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype.zoomImage;
    /** @type {?} */
    NgxImgZoomComponent.prototype.previewImage;
    /**
     * @type {?}
     * @private
     */
    NgxImgZoomComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    NgxImgZoomComponent.prototype.ngxZoomService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWltZy16b29tLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1pbWctem9vbS8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtaW1nLXpvb20uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFpQixLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUcsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFPM0QsTUFBTSxPQUFPLG1CQUFtQjs7Ozs7SUFPOUIsWUFDVSxRQUFtQixFQUNuQixjQUFpQztRQURqQyxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLG1CQUFjLEdBQWQsY0FBYyxDQUFtQjtRQU4zQyxTQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ1osd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQzVCLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBT3JCLGFBQVEsR0FBbUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUM7SUFGcEQsQ0FBQzs7Ozs7SUFjTCxJQUEyQixPQUFPLENBQUMsR0FBRztRQUNwQyxJQUFJLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztRQUNyQixJQUFJLElBQUksQ0FBQyxZQUFZLEtBQUssSUFBSSxFQUFFO1lBQzlCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsT0FBTyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQztTQUM5RTtRQUNELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLCtEQUErRDtJQUNqRSxDQUFDOzs7OztJQUVELElBQThCLFVBQVUsQ0FBQyxHQUFHO1FBQzFDLElBQUksQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDO0lBQzFCLENBQUM7Ozs7SUFFRCxRQUFRO0lBRVIsQ0FB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QUFDLElBQUksR0FBRyxLQUFLLENBQUM7WUFDbEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUM7U0FDNUQ7UUFFRCxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDVCxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDM0Q7UUFFRCxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNoRCxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7WUFDN0MsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDM0Q7UUFFRCxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDVCxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDM0Q7UUFFRCxpQ0FBaUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUNuRCxpQ0FBaUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxvQkFBb0IsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDakgsQ0FBQzs7Ozs7SUFFSCxZQUFZLENBQUMsQ0FBQzs7WUFDTixDQUFDOztZQUFFLENBQUMsR0FBRyxDQUFDOztZQUFFLENBQUMsR0FBRyxDQUFDO1FBQ25CLENBQUMsR0FBRyxDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQztRQUN0QiwyQ0FBMkM7UUFDM0MsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNyQyxzRUFBc0U7UUFDdEUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNyQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQ3BCLGdDQUFnQztRQUNoQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDM0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO1FBQzNCLE9BQU8sRUFBQyxDQUFDLEVBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRyxDQUFDLEVBQUMsQ0FBQztJQUMxQixDQUFDOzs7O0lBRUQsZ0JBQWdCO1FBQ2QsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDNUQsQ0FBQzs7O1lBdEpGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsY0FBYztnQkFDeEIsbVNBQTRDOzthQUU3Qzs7OztZQVAyQixTQUFTO1lBQzVCLGlCQUFpQjs7O3dCQW9CdkIsU0FBUyxTQUFDLEtBQUs7MkJBQ2YsU0FBUyxTQUFDLFFBQVE7OEJBQ2xCLFNBQVMsU0FBQyxXQUFXO3VCQUVyQixLQUFLOzBCQUNMLEtBQUs7d0JBQ0wsS0FBSzs2QkFDTCxLQUFLO3NCQUlMLEtBQUssU0FBQyxjQUFjO3lCQVNwQixLQUFLLFNBQUMsaUJBQWlCOzs7O0lBL0J4QixrQ0FBSTs7SUFBQyxtQ0FBSzs7SUFBQyxxQ0FBTzs7SUFBQyxpQ0FBRzs7SUFBQyxpQ0FBRzs7SUFBQyx3Q0FBVTs7SUFDckMsbUNBQVk7O0lBQ1osa0RBQTRCOztJQUM1QiwyQ0FBcUI7O0lBT3JCLHVDQUF3RDs7SUFDeEQsd0NBQXdDOztJQUN4QywyQ0FBOEM7O0lBQzlDLDhDQUFvRDs7SUFFcEQsdUNBQWtCOztJQUNsQiwwQ0FBcUI7O0lBQ3JCLHdDQUFtQjs7SUFDbkIsNkNBQXdCOztJQUN4Qix3Q0FBVTs7SUFDViwyQ0FBYTs7Ozs7SUFkWCx1Q0FBMkI7Ozs7O0lBQzNCLDZDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgQWZ0ZXJWaWV3SW5pdCwgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5neEltZ1pvb21TZXJ2aWNlIH0gZnJvbSAnLi9uZ3gtaW1nLXpvb20uc2VydmljZSc7XG5pbXBvcnQgeyBOZ3hJbWdab29tTW9kZSB9IGZyb20gJy4vbW9kZS5lbnVtJztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1pbWctem9vbScsXG4gIHRlbXBsYXRlVXJsOiAnLi9uZ3gtaW1nLXpvb20uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9uZ3gtaW1nLXpvb20uY29tcG9uZW50LmNzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3hJbWdab29tQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcblxuICBpbWc7IGxlbnM7IHJlc3VsdDsgY3g7IGN5OyBjb250YWluZXI7XG4gIGhpZGUgPSB0cnVlO1xuICBfdHJpZ2dlckFuaW1hdGlvbkluID0gZmFsc2U7XG4gIG5vdEZpcnN0VGltZSA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBwcml2YXRlIG5neFpvb21TZXJ2aWNlOiBOZ3hJbWdab29tU2VydmljZVxuICApIHsgfVxuXG4gIHpvb21Nb2RlOiBOZ3hJbWdab29tTW9kZSA9IHRoaXMubmd4Wm9vbVNlcnZpY2Uuem9vbU1vZGU7XG4gIEBWaWV3Q2hpbGQoJ2ltZycpIGltZ0VsbVJlZjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgncmVzdWx0JykgcmVzdWx0RWxtUmVmOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjb250YWluZXInKSBjb250YWluZXJFbG1SZWY6IEVsZW1lbnRSZWY7XG5cbiAgQElucHV0KCkgaW1nU3R5bGU7XG4gIEBJbnB1dCgpIHJlc3VsdFN0eWxlO1xuICBASW5wdXQoKSBsZW5zU3R5bGU7XG4gIEBJbnB1dCgpIGNvbnRhaW5lclN0eWxlO1xuICB6b29tSW1hZ2U7XG4gIHByZXZpZXdJbWFnZTtcblxuICBASW5wdXQoJ3pvb21JbWFnZVNyYycpIHNldCBfaW1nU3JjKHZhbCkge1xuICAgIHRoaXMuem9vbUltYWdlID0gdmFsO1xuICAgIGlmICh0aGlzLm5vdEZpcnN0VGltZSA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnJlc3VsdCwgJ2JhY2tncm91bmRJbWFnZScsIFwidXJsKCdcIiArIHZhbCArIFwiJylcIik7XG4gICAgfVxuICAgIHRoaXMubm90Rmlyc3RUaW1lID0gdHJ1ZTtcbiAgICAvLyB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMucmVzdWx0LCAnYmFja2dyb3VuZEltYWdlJywgdmFsKTtcbiAgfVxuXG4gIEBJbnB1dCgncHJldmlld0ltYWdlU3JjJykgc2V0IF96b29tSW1hZ2UodmFsKSB7XG4gICAgdGhpcy5wcmV2aWV3SW1hZ2UgPSB2YWw7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmltZyA9IHRoaXMuaW1nRWxtUmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgdGhpcy5yZXN1bHQgPSB0aGlzLnJlc3VsdEVsbVJlZi5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5jb250YWluZXJFbG1SZWYubmF0aXZlRWxlbWVudDtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuaW1nLCAnc3R5bGUnLCA8c3RyaW5nPnRoaXMuaW1nU3R5bGUpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMucmVzdWx0LCAnc3R5bGUnLCA8c3RyaW5nPnRoaXMucmVzdWx0U3R5bGUpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuY29udGFpbmVyLCAnc3R5bGUnLCA8c3RyaW5nPnRoaXMuY29udGFpbmVyU3R5bGUpO1xuICAgIHRoaXMuaW1hZ2Vab29tKCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxlbnMsICd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICB9XG5cblxuICBpbWFnZVpvb20oKSB7XG4gICAgLypjcmVhdGUgbGVuczoqL1xuICAgIHRoaXMubGVucyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnRElWJyk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmxlbnMsICdpbWctem9vbS1sZW5zJyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5sZW5zLCAnc3R5bGUnLCA8c3RyaW5nPnRoaXMubGVuc1N0eWxlKTtcblxuICAgIC8qaW5zZXJ0IGxlbnM6Ki9cbiAgICB0aGlzLnJlbmRlcmVyLmluc2VydEJlZm9yZSh0aGlzLmltZy5wYXJlbnRFbGVtZW50LCB0aGlzLmxlbnMsIHRoaXMuaW1nKTtcblxuICAgIC8qY2FsY3VsYXRlIHRoZSByYXRpbyBiZXR3ZWVuIHJlc3VsdCBESVYgYW5kIGxlbnM6Ki9cbiAgICB0aGlzLmN4ID0gdGhpcy5yZXN1bHQub2Zmc2V0V2lkdGggLyB0aGlzLmxlbnMub2Zmc2V0V2lkdGg7XG4gICAgdGhpcy5jeSA9IHRoaXMucmVzdWx0Lm9mZnNldEhlaWdodCAvIHRoaXMubGVucy5vZmZzZXRIZWlnaHQ7XG5cbiAgICAvKnNldCBiYWNrZ3JvdW5kIHByb3BlcnRpZXMgZm9yIHRoZSByZXN1bHQgRElWOiovXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnJlc3VsdCwgJ2JhY2tncm91bmRJbWFnZScsIFwidXJsKCdcIiArIHRoaXMuem9vbUltYWdlICsgXCInKVwiKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMucmVzdWx0LCAnYmFja2dyb3VuZFNpemUnLCAodGhpcy5pbWcud2lkdGggKiB0aGlzLmN4KSArICdweCAnICsgKHRoaXMuaW1nLmhlaWdodCAqIHRoaXMuY3kpICsgJ3B4Jyk7XG4gICAgLy8gdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmltZy5wYXJlbnRFbGVtZW50LCAncG9zaXRpb24nLCAncmVsYXRpdmUnKVxuXG4gICAgLypleGVjdXRlIGEgZnVuY3Rpb24gd2hlbiBzb21lb25lIG1vdmVzIHRoZSBjdXJzb3Igb3ZlciB0aGUgaW1hZ2UsIG9yIHRoZSBsZW5zOiovXG4gICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5sZW5zLCAnbW91c2Vtb3ZlJywgdGhpcy5tb3ZlTGVucy5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmltZywgJ21vdXNlbW92ZScsIHRoaXMubW92ZUxlbnMuYmluZCh0aGlzKSk7XG5cbiAgICAvKmFuZCBhbHNvIGZvciB0b3VjaCBzY3JlZW5zOiovXG4gICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5pbWcsICd0b3VjaG1vdmUnLCB0aGlzLm1vdmVMZW5zLmJpbmQodGhpcykpO1xuICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMubGVucywgJ3RvdWNobW92ZScsIHRoaXMubW92ZUxlbnMuYmluZCh0aGlzKSk7XG4gIH1cblxuICBtb3ZlTGVucyhlKSB7XG4gICAgICBsZXQgcG9zLCB4LCB5O1xuICAgICAgLypwcmV2ZW50IGFueSBvdGhlciBhY3Rpb25zIHRoYXQgbWF5IG9jY3VyIHdoZW4gbW92aW5nIG92ZXIgdGhlIGltYWdlOiovXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAvKmdldCB0aGUgY3Vyc29yJ3MgeCBhbmQgeSBwb3NpdGlvbnM6Ki9cbiAgICAgIHBvcyA9IHRoaXMuZ2V0Q3Vyc29yUG9zKGUpO1xuICAgICAgLypjYWxjdWxhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBsZW5zOiovXG4gICAgICB4ID0gcG9zLnggLSAodGhpcy5sZW5zLm9mZnNldFdpZHRoIC8gMik7XG4gICAgICB5ID0gcG9zLnkgLSAodGhpcy5sZW5zLm9mZnNldEhlaWdodCAvIDIpO1xuXG5cbiAgICAgIC8qcHJldmVudCB0aGUgbGVucyBmcm9tIGJlaW5nIHBvc2l0aW9uZWQgb3V0c2lkZSB0aGUgaW1hZ2U6Ki9cbiAgICAgIGlmICh4ID4gdGhpcy5pbWcud2lkdGggLSB0aGlzLmxlbnMub2Zmc2V0V2lkdGgpIHtcbiAgICAgICAgeCA9IHRoaXMuaW1nLndpZHRoIC0gdGhpcy5sZW5zLm9mZnNldFdpZHRoO1xuXG4gICAgICAgIHRoaXMuaGlkZSA9IHRydWU7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGlkZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMubGVucywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgICAgfVxuXG4gICAgICBpZiAoeCA8IDApIHtcbiAgICAgICAgeCA9IDA7XG4gICAgICAgIHRoaXMuaGlkZSA9IHRydWU7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHkgPiB0aGlzLmltZy5oZWlnaHQgLSB0aGlzLmxlbnMub2Zmc2V0SGVpZ2h0KSB7XG4gICAgICAgIHkgPSB0aGlzLmltZy5oZWlnaHQgLSB0aGlzLmxlbnMub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB0aGlzLmhpZGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMubGVucywgJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICh5IDwgMCkge1xuICAgICAgICB5ID0gMDtcbiAgICAgICAgdGhpcy5oaWRlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxlbnMsICd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgfVxuXG4gICAgICAvKnNldCB0aGUgcG9zaXRpb24gb2YgdGhlIGxlbnM6Ki9cbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAnbGVmdCcsIHggKyAncHgnKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndG9wJywgeSArICdweCcpO1xuICAgICAgLypkaXNwbGF5IHdoYXQgdGhlIGxlbnMgJ3NlZXMnOiovXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMucmVzdWx0LCAnYmFja2dyb3VuZFBvc2l0aW9uJywgJy0nICsgKHggKiB0aGlzLmN4KSArICdweCAtJyArICh5ICogdGhpcy5jeSkgKyAncHgnKTtcbiAgICB9XG5cbiAgZ2V0Q3Vyc29yUG9zKGUpIHtcbiAgICAgIGxldCBhLCB4ID0gMCwgeSA9IDA7XG4gICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgICAvKmdldCB0aGUgeCBhbmQgeSBwb3NpdGlvbnMgb2YgdGhlIGltYWdlOiovXG4gICAgICBhID0gdGhpcy5pbWcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAvKmNhbGN1bGF0ZSB0aGUgY3Vyc29yJ3MgeCBhbmQgeSBjb29yZGluYXRlcywgcmVsYXRpdmUgdG8gdGhlIGltYWdlOiovXG4gICAgICB4ID0gZS5wYWdlWCAtIGEubGVmdDtcbiAgICAgIHkgPSBlLnBhZ2VZIC0gYS50b3A7XG4gICAgICAvKmNvbnNpZGVyIGFueSBwYWdlIHNjcm9sbGluZzoqL1xuICAgICAgeCA9IHggLSB3aW5kb3cucGFnZVhPZmZzZXQ7XG4gICAgICB5ID0geSAtIHdpbmRvdy5wYWdlWU9mZnNldDtcbiAgICAgIHJldHVybiB7eCA6IHgsIHkgOiB5fTtcbiAgfVxuXG4gIGhhbmRsZU1vdXNlTGVhdmUoKSB7XG4gICAgdGhpcy5oaWRlID0gdHJ1ZTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMubGVucywgJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gIH1cblxufVxuIl19